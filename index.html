<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé≠ Teatro Coach IA</title>
<style>
body{font-family:system-ui,-apple-system,sans-serif;margin:0;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;color:#fff}
.container{max-width:600px;width:90%;padding:2rem;background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:20px;box-shadow:0 8px 32px rgba(0,0,0,0.3)}
h1{text-align:center;margin:0 0 2rem}
.step{display:none}
.step.active{display:block}
.upload-area{border:3px dashed rgba(255,255,255,0.5);border-radius:15px;padding:3rem;text-align:center;cursor:pointer;transition:all 0.3s}
.upload-area:hover{background:rgba(255,255,255,0.1);border-color:#fff}
input[type=file]{display:none}
button{background:#fff;color:#667eea;border:none;padding:1rem 2rem;border-radius:10px;font-size:1rem;font-weight:600;cursor:pointer;transition:transform 0.2s;width:100%;margin-top:1rem}
button:hover{transform:scale(1.05)}
button:disabled{opacity:0.5;cursor:not-allowed;transform:none}
.character-list{margin:1.5rem 0}
.character-item{background:rgba(255,255,255,0.2);padding:1rem;margin:0.5rem 0;border-radius:10px;display:flex;justify-content:space-between;align-items:center}
select{background:rgba(255,255,255,0.9);border:none;padding:0.5rem;border-radius:5px;color:#333;font-size:0.9rem}
.rehearsal{text-align:center}
.line-display{background:rgba(255,255,255,0.2);padding:2rem;border-radius:15px;margin:2rem 0;min-height:100px}
.character-name{font-size:1.2rem;font-weight:700;margin-bottom:1rem}
.dialogue{font-size:1.1rem;line-height:1.6}
.mic-button{width:100px;height:100px;border-radius:50%;background:#ff4757;color:#fff;border:none;font-size:3rem;cursor:pointer;transition:all 0.3s;margin:2rem auto;display:block}
.mic-button:hover{transform:scale(1.1)}
.mic-button.recording{background:#2ed573;animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
.progress{margin:1rem 0;text-align:center;font-size:0.9rem}
.info{background:rgba(255,255,255,0.2);padding:1rem;border-radius:10px;margin:1rem 0;font-size:0.9rem}
</style>
</head>
<body>
<div class="container">
<h1>üé≠ Teatro Coach IA</h1>
<div id="step1" class="step active">
<div class="upload-area" onclick="document.getElementById('pdffile').click()">
<p>üìÑ Haz clic para subir tu guion (PDF)</p>
<input type="file" id="pdffile" accept=".pdf">
</div>
<div id="uploadStatus"></div>
</div>
<div id="step2" class="step">
<h2>Personajes del guion</h2>
<div class="info">Asigna una voz a cada personaje</div>
<div id="characterList" class="character-list"></div>
<button onclick="startRehearsal()">Iniciar ensayo</button>
</div>
<div id="step3" class="step">
<div class="progress"><span id="progressText">L√≠nea 1 de X</span></div>
<div class="line-display">
<div class="character-name" id="currentCharacter"></div>
<div class="dialogue" id="currentDialogue"></div>
</div>
<button class="mic-button" id="micBtn" onclick="toggleMic()">üé§</button>
<div class="info">Presiona el micr√≥fono y di tu l√≠nea</div>
<audio id="audioPlayer" style="display:none"></audio>
</div>
</div>
<script>
const API='/api';
let scriptData=null;
let rehearsalSession=null;
let isRecording=false;
let mediaRecorder=null;
let audioChunks=[];
let currentLineIndex=0;
document.getElementById('pdffile').addEventListener('change',async(e)=>{
const file=e.target.files[0];
if(!file)return;
const status=document.getElementById('uploadStatus');
status.innerHTML='<div class="info">‚è≥ Procesando guion...</div>';
const formData=new FormData();
formData.append('script',file);
try{
const res=await fetch(API+'/upload-script',{method:'POST',body:formData});
const data=await res.json();
if(data.success){
scriptData=data.script;
status.innerHTML='<div class="info">‚úÖ Guion cargado: '+data.script.totalLines+' l√≠neas</div>';
showCharacterSetup();
}else{
status.innerHTML='<div class="info">‚ùå Error: '+data.error+'</div>';
}
}catch(err){
status.innerHTML='<div class="info">‚ùå Error al subir el archivo</div>';
}
});
function showCharacterSetup(){
const list=document.getElementById('characterList');
const voices=['alloy','echo','fable','onyx','nova','shimmer'];
list.innerHTML=scriptData.characters.map((char,i)=>`
<div class="character-item">
<span>${char}</span>
<select id="voice_${i}">
${voices.map(v=>`<option value="${v}"${i%6===voices.indexOf(v)?' selected':''}>${v}</option>`).join('')}
</select>
</div>
`).join('');
document.getElementById('step1').classList.remove('active');
document.getElementById('step2').classList.add('active');
}
async function startRehearsal(){
const characterVoices={};
scriptData.characters.forEach((char,i)=>{
characterVoices[char]=document.getElementById('voice_'+i).value;
});
try{
const res=await fetch(API+'/setup-rehearsal',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({characterVoices})
});
rehearsalSession=await res.json();
if(rehearsalSession.success){
document.getElementById('step2').classList.remove('active');
document.getElementById('step3').classList.add('active');
loadNextLine();
}
}catch(err){
alert('Error al iniciar ensayo');
}
}
async function loadNextLine(){
try{
const res=await fetch(API+'/next-line');
const data=await res.json();
if(data.done){
alert('¬°Ensayo completado! üéâ');
window.location.reload();
return;
}
document.getElementById('currentCharacter').textContent=data.line.character;
document.getElementById('currentDialogue').textContent=data.line.dialogue;
document.getElementById('progressText').textContent=`L√≠nea ${data.lineNumber} de ${scriptData.totalLines}`;
currentLineIndex=data.lineNumber;
playAILine(data.line.dialogue,data.line.character);
}catch(err){
alert('Error al cargar l√≠nea');
}
}
async function playAILine(text,character){
try{
const res=await fetch(API+'/generate-audio',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({text,character})
});
const audioBlob=await res.blob();
const audioUrl=URL.createObjectURL(audioBlob);
const audio=document.getElementById('audioPlayer');
audio.src=audioUrl;
audio.play();
}catch(err){
console.error('Error reproduciendo audio:',err);
}
}
async function toggleMic(){
if(!isRecording){
startRecording();
}else{
stopRecording();
}
}
async function startRecording(){
try{
const stream=await navigator.mediaDevices.getUserMedia({audio:true});
mediaRecorder=new MediaRecorder(stream);
audioChunks=[];
mediaRecorder.addEventListener('dataavailable',e=>{
audioChunks.push(e.data);
});
mediaRecorder.addEventListener('stop',async()=>{
const audioBlob=new Blob(audioChunks,{type:'audio/webm'});
await analyzePerformance(audioBlob);
});
mediaRecorder.start();
isRecording=true;
const btn=document.getElementById('micBtn');
btn.classList.add('recording');
btn.textContent='‚è∏';
}catch(err){
alert('No se pudo acceder al micr√≥fono');
}
}
function stopRecording(){
if(mediaRecorder&&mediaRecorder.state!=='inactive'){
mediaRecorder.stop();
mediaRecorder.stream.getTracks().forEach(track=>track.stop());
isRecording=false;
const btn=document.getElementById('micBtn');
btn.classList.remove('recording');
btn.textContent='üé§';
}
}
async function analyzePerformance(audioBlob){
try{
const formData=new FormData();
formData.append('audio',audioBlob,'recording.webm');
const res=await fetch(API+'/transcribe',{method:'POST',body:formData});
const data=await res.json();
if(data.text){
const expected=document.getElementById('currentDialogue').textContent;
const character=document.getElementById('currentCharacter').textContent;
const feedbackRes=await fetch(API+'/analyze-performance',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({userText:data.text,expectedText:expected,character})
});
const feedbackData=await feedbackRes.json();
if(feedbackData.feedback){
playFeedback(feedbackData.feedback);
setTimeout(loadNextLine,3000);
}
}
}catch(err){
alert('Error analizando interpretaci√≥n');
}
}
async function playFeedback(text){
try{
const res=await fetch(API+'/generate-audio',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({text,character:'Director'})
});
const audioBlob=await res.blob();
const audioUrl=URL.createObjectURL(audioBlob);
const audio=document.getElementById('audioPlayer');
audio.src=audioUrl;
audio.play();
}catch(err){
console.error('Error reproduciendo feedback:',err);
}
}
</script>
</body>
</html>
